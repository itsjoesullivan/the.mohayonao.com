!function(t){"use strict";function n(t){return 0|t}function i(t){return 15&(0|t)}function r(t,n){return"undefined"==typeof t?n:t}function e(t,n,i){return n>=0&&n<t.width&&i>=0&&i<t.height?t.data[i*t.width+n]:-1}function o(t,n){var i=t.colorPalette;return n*=3,i[n]|i[n+1]<<8|i[n+2]<<16}function u(t,n,i){var r=t.colorPalette;n*=3,r[n]=17*(i>>4&15),r[n+1]=17*(i>>12&15),r[n+2]=17*(i>>20&15)}function f(t,n){return t.tilePalette[n]}function c(t,n,i){0!==n&&(t.tilePalette[n]=i)}function a(t,n){for(var i=t.data,r=0,e=i.length;e>r;r++)i[r]=n}function h(t,n,i,r){n>=0&&n<t.width&&i>=0&&i<t.height&&(t.data[i*t.width+n]=r)}function s(t,n,i,r,e,o){var u=Math.abs(n-r),f=Math.abs(i-e),c=r>n?1:-1,a=e>i?1:-1;0===u?d(t,n,i,u,f,c,a,o):0===f?l(t,n,i,u,f,c,a,o):u>=f?v(t,n,i,u,f,c,a,o):w(t,n,i,u,f,c,a,o)}function l(t,n,i,r,e,o,u,f){for(var c=0;r>=c;n+=o,c++)h(t,n,i,f)}function d(t,n,i,r,e,o,u,f){for(var c=0;e>=c;i+=u,c++)h(t,n,i,f)}function v(t,n,i,r,e,o,u,f){for(var c=-r,a=0;r>=a;n+=o,a++)h(t,n,i,f),c+=2*e,c>=0&&(i+=u,c-=2*r)}function w(t,n,i,r,e,o,u,f){for(var c=-e,a=0;e>=a;i+=u,a++)h(t,n,i,f),c+=2*r,c>=0&&(n+=o,c-=2*e)}function g(t,n,i,r,e,o,u){var f=Math.abs(r)-1,c=Math.abs(e)-1,a=r>=0?1:-1,h=e>=0?1:-1;u?y(t,n,i,r,e,f,c,a,h,o):A(t,n,i,r,e,f,c,a,h,o)}function y(t,n,i,r,e,o,u,f,c,a){for(var h=0;u>=h;i+=c,h++)l(t,n,i,o,0,f,0,a)}function A(t,n,i,r,e,o,u,f,c,a){l(t,n,i,o,0,f,0,a),l(t,n,i+e-c,o,0,f,0,a),d(t,n,i,0,u,0,c,a),d(t,n+r-f,i,0,u,0,c,a)}function p(t,n,i,r,e,o){o?P(t,n,i,r,e):U(t,n,i,r,e)}function P(t,n,i,r,e){b(t,n,i,r,function(r,o){l(t,n-r,i-o,2*r,0,1,0,e),l(t,n-r,i+o,2*r,0,1,0,e),l(t,n-o,i+r,2*o,0,1,0,e),l(t,n-o,i-r,2*o,0,1,0,e)})}function U(t,n,i,r,e){b(t,n,i,r,function(r,o){h(t,n+r,i+o,e),h(t,n-r,i+o,e),h(t,n+r,i-o,e),h(t,n-r,i-o,e),h(t,n+o,i+r,e),h(t,n-o,i+r,e),h(t,n+o,i-r,e),h(t,n-o,i-r,e)})}function b(t,n,i,r,e){for(var o=r,u=0,f=-3*r+3;o>=u;)e(o,u),f>=0&&(f-=4*--o),f+=4*++u+2}function T(t,n,i,r,e,o,u){u?m(t,n,i,r,e,o):C(t,n,i,r,e,o)}function m(t,n,i,r,e,o){M(t,n,i,r,e,function(r,e){l(t,n-r,i+e,2*r,0,1,0,o),l(t,n-r,i-e,2*r,0,1,0,o)})}function C(t,n,i,r,e,o){M(t,n,i,r,e,function(r,e){h(t,n+r,i+e,o),h(t,n-r,i+e,o),h(t,n+r,i-e,o),h(t,n-r,i-e,o)})}function M(t,n,i,r,e,o){for(var u=r,f=0,c=Math.pow(r/e,2),a=r,h=-2*a+1+2*c,s=-4*a+2+c;u>=0;)o(u,f),h>=0&&(u--,h-=4*u,s-=4*u-2),0>s&&(f++,h+=4*c*f+2*c,s+=4*c*f)}function R(t,n,i,r,e){n.split("").forEach(function(n,o){n=n.charCodeAt(0),n>=33&&126>=n&&x(t,n,i+6*o,r,e)})}function x(t,n,i,r,e){var o=F[n-33];o.forEach(function(n,o){[1,2,4,8,16,32,64].forEach(function(u,f){n&u&&h(t,i+o,r+f,e)})})}function E(t,n,i,r,e){e?B(t,n,i,r):j(t,n,i,r)}function j(t,n,i,r){var o=e(t,n,i),u=function(n,i){return e(t,n,i)!==o},f=function(t,n,i,r){for(;n>=t;){for(;n>=t&&u(t,i);)t++;if(u(t,i))break;for(;n>=t&&!u(t,i);)t++;r.push(t-1,i)}};G(t,n,i,r,u,f)}function B(t,n,i,r){var o=function(n,i){return e(t,n,i)===r},u=function(n,i,r,e){for(;i>=n&&n<t.width;)o(n,r)||e.push(n,r),n++};G(t,n,i,r,o,u)}function G(t,n,i,r,e,o){function u(n,i){for(;n<t.width&&!e(n+1,i);)n++;return n}function f(t,n){for(;t>0&&!e(t-1,n);)t--;return t}var c=[n,i];do if(n=c.shift(),i=c.shift(),!e(n,i)){var a=u(n,i),h=f(n,i);l(t,h,i,a-a,0,1,0,r),i-1>=0&&o(h,a,i-1,c),i+1<t.height&&o(h,a,i+1,c)}while(c.length)}function k(t,i,r){if(3840&i){var e=t.tilePalette[i>>8],o=n(r%t.width)%4,u=n(r/t.width)%4*4,f=e&1<<o+u;return f?(240&i)>>4:15&i}return 15&i}function q(t){for(var n=new Uint8Array(t.width*t.height*3),i=t.data,r=t.colorPalette,e=0,o=0,u=i.length;u>o;o++){var f=3*k(t,i[o],o);n[e++]=r[f],n[e++]=r[f+1],n[e++]=r[f+2]}return n}function H(t,n){for(var i=new Uint8Array(t.width*t.height*4),r=t.data,e=t.colorPalette,o=0,u=0,f=r.length;f>u;u++){var c=3*k(t,r[u],u);i[o++]=e[c],i[o++]=e[c+1],i[o++]=e[c+2],i[o++]=n}return i}function I(t){for(var n=new Uint8Array(t.width*t.height),i=t.data,r=0,e=i.length;e>r;r++){var o=k(t,i[r],r);n[r]=o}return n}function S(t){return"number"==typeof t?i(t):Array.isArray(t)?W(t):0}function W(t){var n=i(t[0]),r=i(t[1]),e=i(t[2]);return n===r||0===e?n:n|r<<4|e<<8}function X(t,e,l){t=n(r(t,640)),e=n(r(e,400));var d={width:t,height:e};l?(d.data=new Uint16Array(l.data),d.colorPalette=new Uint8Array(l.colorPalette),d.tilePalette=new Uint16Array(l.tilePalette)):(d.data=new Uint16Array(t*e),d.colorPalette=new Uint8Array(z),d.tilePalette=new Uint16Array(D)),this.getWidth=function(){return t},this.getHeight=function(){return e},this.getColor=function(t){return o(d,i(t))},this.setColor=function(t,r){return u(d,i(t),n(r)),this},this.getTile=function(t){return f(d,t)},this.setTile=function(t,r){return c(d,i(t),n(r)),this},this.clear=function(t){return a(d,S(t)),this},this.dot=function(t,i,r){return h(d,n(t),n(i),S(r)),this},this.line=function(t,i,r,e,o){return s(d,n(t),n(i),n(r),n(e),S(o)),this},this.rect=function(t,i,r,e,o,u){return g(d,n(t),n(i),n(r),n(e),S(o),!!u),this},this.circle=function(t,i,r,e,o){return p(d,n(t),n(i),n(r),S(e),!!o),this},this.ellipse=function(t,i,r,e,o,u){return T(d,n(t),n(i),n(r),n(e),S(o),!!u),this},this.text=function(t,i,r,e){return R(d,String(t),n(i),n(r),S(e)),this},this.plotter=function(t,i,r){return new Y(this,n(t),n(i),S(r))},this.paint=function(t,i,r,e){return E(d,n(t),n(i),S(r),!!e),this},this.clone=function(){return new X(t,e,d)},this.toRGB=function(){return q(d)},this.toRGBA=function(t){return H(d,n(r(t,255)))},this.toIndexedColor=function(){return I(d)}}function Y(t,i,r,e){this.getX=function(){return i},this.getY=function(){return r},this.moveTo=function(t,e){return i=n(t),r=n(e),this},this.lineTo=function(o,u){var f=i,c=n(o),a=r,h=n(u);return t.line(f,a,c,h,e),i=c,r=h,this},this.moveToRel=function(t,e){return this.moveTo(i+n(t),r+n(e))},this.lineToRel=function(t,e){return this.lineTo(i+n(t),r+n(e))}}var z=new Uint8Array([0,0,0,0,0,119,119,0,0,119,0,119,0,119,0,0,119,119,119,119,0,119,119,119,68,68,68,0,0,255,255,0,0,255,0,255,0,255,0,0,255,255,255,255,0,255,255,255]),D=new Uint16Array([0,1,1025,1029,1285,1317,34085,34213,42405,42407,44455,44463,44975,44991,61375,61439]),F=[[0,0,95,0,0],[0,7,0,7,0],[20,127,20,127,20],[36,42,127,42,18],[35,19,8,100,98],[54,73,85,34,80],[0,5,3,0,0],[0,28,34,65,0],[0,65,34,28,0],[8,42,28,42,8],[8,8,62,8,8],[0,80,48,0,0],[8,8,8,8,8],[0,96,96,0,0],[32,16,8,4,2],[62,81,73,69,62],[0,66,127,64,0],[66,97,81,73,70],[33,65,69,75,49],[24,20,18,127,16],[39,69,69,69,57],[60,74,73,73,48],[1,113,9,5,3],[54,73,73,73,54],[6,73,73,41,30],[0,54,54,0,0],[0,86,54,0,0],[0,8,20,34,65],[20,20,20,20,20],[65,34,20,8,0],[2,1,81,9,6],[50,73,121,65,62],[126,17,17,17,126],[127,73,73,73,54],[62,65,65,65,34],[127,65,65,34,28],[127,73,73,73,65],[127,9,9,1,1],[62,65,65,81,50],[127,8,8,8,127],[0,65,127,65,0],[32,64,65,63,1],[127,8,20,34,65],[127,64,64,64,64],[127,2,4,2,127],[127,4,8,16,127],[62,65,65,65,62],[127,9,9,9,6],[62,65,81,33,94],[127,9,25,41,70],[70,73,73,73,49],[1,1,127,1,1],[63,64,64,64,63],[31,32,64,32,31],[127,32,24,32,127],[99,20,8,20,99],[3,4,120,4,3],[97,81,73,69,67],[0,0,127,65,65],[2,4,8,16,32],[65,65,127,0,0],[4,2,1,2,4],[64,64,64,64,64],[0,1,2,4,0],[32,84,84,84,120],[127,72,68,68,56],[56,68,68,68,32],[56,68,68,72,127],[56,84,84,84,24],[8,126,9,1,2],[8,20,84,84,60],[127,8,4,4,120],[0,68,125,64,0],[32,64,68,61,0],[0,127,16,40,68],[0,65,127,64,0],[124,4,24,4,120],[124,8,4,4,120],[56,68,68,68,56],[124,20,20,20,8],[8,20,20,24,124],[124,8,4,4,8],[72,84,84,84,32],[4,63,68,64,32],[60,64,64,32,124],[28,32,64,32,28],[60,64,48,64,60],[68,40,16,40,68],[12,80,80,80,60],[68,100,84,76,68],[0,8,54,65,0],[0,0,127,0,0],[0,65,54,8,0]],J={version:"0.1.1",Canvas:function(t,i){return t=n(r(t,640)),i=n(r(i,400)),new X(t,i)}};"function"==typeof require&&"object"==typeof J&&"object"==typeof module?module.exports=J:"function"==typeof t.define&&t.define.amd?t.define(function(){return J}):t.gretro=J}(this.self||global);